<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>MeteoCal Change Password</title>
    </h:head>
    <h:body>
       <h:panelGroup id="parent_container">
            <h:form id="parent_form" style="background: rgba(100, 130, 30, .7) !important; color: #ffffff !important;">
                <p:growl id="msgs" showDetail="true" />
                <h:panelGrid id="data_panel" columns="2">
                    <h:outputLabel value="Email:" for="emailInput" />
                    <p:inputText id="emailInput" required="true"
                                 value="#{changePasswordBean.email}" title="Email" >
                         <f:ajax event="blur" render=":parent_container :parent_form :data_panel"/>
                    </p:inputText>
                    
                    <h:outputLabel value="Password:" for="passwordInput" />
                    <p:inputText id="passwordInput" required="true"
                                 value="#{changePasswordBean.password}" title="Password" >
                         <f:ajax event="blur" render=":parent_container :parent_form :data_panel"/>
                    </p:inputText>
                    
                    <h:outputLabel value="Retype Password:" for="rePasswordInput" />
                    <p:inputText id="rePasswordInput" validator="#{changePasswordBean.validateRePassword}"
                                 value="#{changePasswordBean.re_pasword}" title="Retype Password:" >
                         <f:ajax event="blur" render=":parent_container :parent_form :data_panel"/>
                    </p:inputText>
                    
                    <h:panelGroup id="passwordMsgPadding" rendered="#{not(changePasswordBean.passwordValid)}"/>
                    <h:outputText id="passwordMsg" value="#{changePasswordBean.passwordMsg}"
                                  rendered="#{not(changePasswordBean.passwordValid)}" />
                    
                    <p:link outcome="logInPage" value="Log In"/>
                    <h:panelGroup/>
                    <p:commandButton id="changePasswordRequestButton" value="Request Password Change" class="button alt" >
                         <f:ajax  event="click"  render=":parent_container :parent_form :data_panel"  
                                    execute=":parent_form" listener="#{changePasswordBean.sendRandomCode()}" />
                    </p:commandButton>
                    <br/>
                    
                    <h:outputLabel value="Copy Code here:" for="reCodeInput" />
                    <p:inputText id="reCodeInput" validator="#{changePasswordBean.validateReCode}"
                                 value="#{changePasswordBean.re_code}" title="Copy Code here:" >
                         <f:ajax event="blur" render=":parent_container :parent_form :data_panel"/>
                    </p:inputText>
                    
                    <h:panelGroup id="codeMsgPadding" rendered="#{not(changePasswordBean.codeValid)}"/>
                    <h:outputText id="codeMsg" value="#{changePasswordBean.codeMsg}"
                                  rendered="#{not(changePasswordBean.codeValid)}" />
                    <h:panelGroup/>
                    
                    <p:commandButton id="changePasswordSubmitButton" value="Submit code" class="button alt" >
                         <f:ajax event="click"  render=":parent_container :parent_form :data_panel"  
                                    execute=":parent_form" listener="#{changePasswordBean.changePassword()}" />
                    </p:commandButton>
                </h:panelGrid>
            </h:form>
        </h:panelGroup>
    </h:body>
</html>

